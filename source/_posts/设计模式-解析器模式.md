---
title: 解释器模式
categories:
  - 设计模式
tags:
  - 设计模式
author: 长歌
abbrlink: 1940214718
date: 2019-11-13 19:20:00
---

解释器模式（Interpreter Pattern）提供了评估语言的语法或表达式的方式，它属于行为型模式。这种模式实现了一个表达式接口，该接口解释一个特定的上下文。这种模式被用在 SQL 解析、符号处理引擎等。
<!-- More -->

## Class Diagram
{% asset_img interpreter.png 解释器UML类图 %}

## Implementation
### 表达式接口
```java
public interface Expression {
    public int interpret();
}
```

### 非终结表达式(操作符表达式)
```java
public abstract class NonTerminalExpression implements Expression {
    Expression e1,e2;

    public NonTerminalExpression(Expression e1, Expression e2) {
        this.e1 = e1;
        this.e2 = e2;
    }
}
```
- 加法操作
```java
public class PlusExpression extends NonTerminalExpression{
    public PlusExpression(Expression e1, Expression e2) {
        super(e1, e2);
    }


    @Override
    public int interpret() {
        return  this.e1.interpret() + this.e2.interpret();
    }
}
```
- 减法操作
```java
public class MinusExpression extends NonTerminalExpression {
    public MinusExpression(Expression e1, Expression e2) {
        super(e1, e2);
    }

    @Override
    public int interpret() {
        return this.e1.interpret() - this.e2.interpret();
    }

}
```


### 终结表达式(数据表达式)
```java
public class TerminalExpression implements Expression{

    String value;

    public TerminalExpression(String value) {
        this.value = value;
    }

    @Override
    public int interpret() {
        return Integer.parseInt(value);
    }
}
```

### 测试方法
```java
    @Test
    public void test() throws Exception {
        TerminalExpression s3 = new TerminalExpression("3");
        TerminalExpression s5 = new TerminalExpression("5");
        TerminalExpression s8 = new TerminalExpression("8");

        int result = new MinusExpression(new PlusExpression(s3,s8),s5).interpret();
        System.out.println(result);
    }
```

### 增加解析器及测试
```java
public final class ExpressionParser {

    public static Expression parse(String expr){
        Expression expression = null;
        for(int i=0;i<expr.length();i++){
            char ch =  expr.charAt(i);
            switch(ch){
                case '+':
                    expression = new PlusExpression(expression,new TerminalExpression(String.valueOf(expr.charAt(++i))));
                    break;
                case '-':
                    expression = new MinusExpression(expression,new TerminalExpression(String.valueOf(expr.charAt(++i))));
                    break;
                default:
                    expression = new TerminalExpression(String.valueOf(ch));
            }
        }
        return expression;
    }
}

// ============================== 测试方法 ==============================
    @Test
    public void test2() throws Exception{
        Expression exp = ExpressionParser.parse("3+8-5");
        int result = exp.interpret();
        System.out.println(result);
    }
```

## Example
- [java.util.Pattern](http://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html)
- [java.text.Format 及子类](http://docs.oracle.com/javase/8/docs/api/java/text/Format.html)


## Refence
- [<大话设计模式>](https://book.douban.com/subject/2334288/)
- [设计模式 | 菜鸟教程](https://www.runoob.com/design-pattern/design-pattern-tutorial.html)
- [Github | CyC2018](https://github.com/CyC2018/CS-Notes/blob/master/notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E7%9B%AE%E5%BD%95.md)