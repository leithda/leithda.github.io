---
title: 访问者模式
abbrlink: 2960930216
date: 2019-12-12 09:06:15
categories:
  - 理论
  - 设计模式
tags:
  - 设计模式
author: 长歌
---

{% cq %}
通过访问者模式，可以通过访问者类进行对固定数据的不同方式的访问。增加访问方式只要增加访问类而不需要更改数据对象。
{% endcq %}
<!-- More -->

## Class Diagram
{% asset_img visitor.png 访问者模式UML图 %}

## Implementation
### 数据接口
```java
public interface Element {
    void accept(Visitor visitor);
}
```

### 具体数据类型
```java
public class ElementA implements Element {
    @Override
    public void accept(Visitor visitor) {
        visitor.visit(this);
    }

    public void operationA(){
        System.out.println("Element A operation");
    }
}

public class ElementB implements Element {
    @Override
    public void accept(Visitor visitor) {
        visitor.visit(this);
    }

    public void operationB(){
        System.out.println("Element B operation");
    }
}
```

### 访问者接口
```java

public class TwoVisitor extends Visitor {
    @Override
    public void visit(ElementA elemA) {
        System.out.println("访问者 TwoVisitor 访问 ElementA");
    }

    @Override
    public void visit(ElementB elemB) {
        System.out.println("访问者 TwoVisitor 访问 ElementB");
    }
}
```

## 对外提供访问
```java
public class ObjectStructure {

    private List<Element> elementList = new ArrayList<Element>();

    public void attach(Element element){
        elementList.add(element);
    }

    public void detach(Element element){
        elementList.remove(element);
    }

    public void accept(Visitor visitor){
        elementList.forEach((element)->{
            element.accept(visitor);
        });
    }
}
```ass Visitor {
    public abstract void visit(ElementA elemA);
    public abstract void visit(ElementB elemB);
}
```
### 具体访问者
```java
public class OneVisitor extends Visitor {
    @Override
    public void visit(ElementA elemA) {
        System.out.println("访问者 OneVisitor 访问 ElementA");
    }

    @Override
    public void visit(ElementB elemB) {
        System.out.println("访问者 OneVisitor 访问 ElementB");
    }
}

public class TwoVisitor extends Visitor {
    @Override
    public void visit(ElementA elemA) {
        System.out.println("访问者 TwoVisitor 访问 ElementA");
    }

    @Override
    public void visit(ElementB elemB) {
        System.out.println("访问者 TwoVisitor 访问 ElementB");
    }
}
```

### 对外提供访问
```java
public class ObjectStructure {

    private List<Element> elementList = new ArrayList<Element>();

    public void attach(Element element){
        elementList.add(element);
    }

    public void detach(Element element){
        elementList.remove(element);
    }

    public void accept(Visitor visitor){
        elementList.forEach((element)->{
            element.accept(visitor);
        });
    }
}
```

## Exmaple
- javax.lang.model.element.Element and javax.lang.model.element.ElementVisitor
- javax.lang.model.type.TypeMirror and javax.lang.model.type.TypeVisitor

## Reflence
- [<大话设计模式>](https://book.douban.com/subject/2334288/)
- [设计模式 | 菜鸟教程](https://www.runoob.com/design-pattern/design-pattern-tutorial.html)
- [Github | CyC2018](https://github.com/CyC2018/CS-Notes/blob/master/notes/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E7%9B%AE%E5%BD%95.md)
 
